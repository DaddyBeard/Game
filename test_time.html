<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test del Sistema de Tiempo - SkyTycoon</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a2e;
            color: #eee;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        .test-section {
            background: #16213e;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #0f3460;
        }
        h1 {
            color: #00d9ff;
            text-align: center;
        }
        h2 {
            color: #ffa500;
            border-bottom: 2px solid #ffa500;
            padding-bottom: 10px;
        }
        .status {
            font-size: 24px;
            font-weight: bold;
            padding: 15px;
            background: #0f3460;
            border-radius: 5px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .time-display {
            color: #00ff88;
            font-size: 28px;
        }
        .controls button {
            background: #00d9ff;
            color: #1a1a2e;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }
        .controls button:hover {
            background: #00ff88;
        }
        .controls button.active {
            background: #ffa500;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .stat-card {
            background: #0f3460;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .stat-label {
            color: #aaa;
            font-size: 12px;
            text-transform: uppercase;
        }
        .stat-value {
            color: #00ff88;
            font-size: 20px;
            font-weight: bold;
            margin-top: 5px;
        }
        .log {
            background: #0a0a0a;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
            margin-top: 15px;
        }
        .log-entry {
            padding: 5px;
            border-bottom: 1px solid #222;
        }
        .log-entry.success { color: #00ff88; }
        .log-entry.warning { color: #ffa500; }
        .log-entry.info { color: #00d9ff; }
        .progress-bar {
            background: #0a0a0a;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            background: linear-gradient(90deg, #00d9ff, #00ff88);
            height: 100%;
            transition: width 0.1s linear;
        }
    </style>
</head>
<body>
    <h1>üïê Test del Sistema de Tiempo</h1>
    
    <div class="test-section">
        <h2>üìä Estado Actual</h2>
        <div class="status">
            <span>Fecha y Hora del Juego:</span>
            <span class="time-display" id="game-time">--:--:--</span>
        </div>
        <div class="status">
            <span>Velocidad:</span>
            <span class="time-display" id="speed-display">1x</span>
        </div>
        <div class="status">
            <span>Estado:</span>
            <span class="time-display" id="pause-status">CORRIENDO</span>
        </div>
    </div>

    <div class="test-section">
        <h2>üéÆ Controles</h2>
        <div class="controls">
            <button id="btn-pause">‚è∏Ô∏è Pausar</button>
            <button id="btn-speed-05" data-speed="0.5">üêå 0.5x</button>
            <button id="btn-speed-1" data-speed="1" class="active">‚ñ∂Ô∏è 1x</button>
            <button id="btn-speed-2" data-speed="2">‚è© 2x</button>
            <button id="btn-speed-5" data-speed="5">‚ö° 5x</button>
            <button id="btn-speed-10" data-speed="10">üöÄ 10x</button>
            <button id="btn-reset">üîÑ Reiniciar Prueba</button>
        </div>
    </div>

    <div class="test-section">
        <h2>üìà Estad√≠sticas de Rendimiento</h2>
        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">Tiempo Real Transcurrido</div>
                <div class="stat-value" id="real-time">0s</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Minutos de Juego Avanzados</div>
                <div class="stat-value" id="game-minutes">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Horas de Juego Avanzadas</div>
                <div class="stat-value" id="game-hours">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">D√≠as de Juego Avanzados</div>
                <div class="stat-value" id="game-days">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">FPS Promedio</div>
                <div class="stat-value" id="fps">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Delta Promedio (ms)</div>
                <div class="stat-value" id="delta-avg">0</div>
            </div>
        </div>
        
        <h3 style="color: #00d9ff; margin-top: 20px;">Progreso hasta el pr√≥ximo d√≠a:</h3>
        <div class="progress-bar">
            <div class="progress-fill" id="day-progress" style="width: 0%"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>üìù Log de Eventos</h2>
        <div class="log" id="event-log"></div>
    </div>

    <script type="module">
        // Simulaci√≥n simplificada del TimeManager para testing
        class TestTimeManager {
            constructor() {
                this.speed = 1;
                this.accumulator = 0;
                this.SPEED_MINUTE_MS = {
                    0.5: 2083.33,
                    1: 1041.67,
                    2: 520.83,
                    5: 208.33,
                    10: 104.17,
                    20: 52.08
                };
                this.minuteLengthMs = this.SPEED_MINUTE_MS[1];
                this.isPaused = false;
                this.gameDate = new Date(2025, 0, 1, 6, 0, 0).getTime();
                this.startDate = this.gameDate;
                this.startRealTime = performance.now();
                
                // Stats
                this.minutesPassed = 0;
                this.dayChanges = 0;
                this.frameCount = 0;
                this.deltaSum = 0;
            }

            setSpeed(newSpeed) {
                this.speed = newSpeed;
                const mapped = this.SPEED_MINUTE_MS[newSpeed];
                if (mapped) {
                    this.minuteLengthMs = mapped;
                }
                this.log(`Velocidad cambiada a ${newSpeed}x`, 'info');
                return this.speed;
            }

            togglePause() {
                this.isPaused = !this.isPaused;
                this.log(this.isPaused ? 'Juego pausado' : 'Juego reanudado', 'warning');
                return this.isPaused;
            }

            update(delta) {
                if (this.isPaused) return;

                // Protecci√≥n contra parones largos
                const safeDelta = Math.min(delta, 5000);
                this.accumulator += safeDelta;
                
                // Stats
                this.frameCount++;
                this.deltaSum += delta;

                const minuteLength = this.minuteLengthMs;

                if (this.accumulator >= minuteLength) {
                    const minutesPassed = Math.floor(this.accumulator / minuteLength);
                    this.advanceTime(minutesPassed);
                    this.accumulator %= minuteLength;
                }
            }

            advanceTime(minutes) {
                const oldDate = new Date(this.gameDate);
                const oldDay = oldDate.getDate();

                this.gameDate += minutes * 60000;
                this.minutesPassed += minutes;

                const newDate = new Date(this.gameDate);
                const newDay = newDate.getDate();

                if (oldDay !== newDay) {
                    this.dayChanges++;
                    this.log(`¬°Nuevo d√≠a! ${newDate.toLocaleDateString('es-ES')}`, 'success');
                }
            }

            log(message, type = 'info') {
                const logContainer = document.getElementById('event-log');
                const entry = document.createElement('div');
                entry.className = `log-entry ${type}`;
                const timestamp = new Date().toLocaleTimeString();
                entry.textContent = `[${timestamp}] ${message}`;
                logContainer.insertBefore(entry, logContainer.firstChild);
                
                // Limitar a 50 entradas
                while (logContainer.children.length > 50) {
                    logContainer.removeChild(logContainer.lastChild);
                }
            }

            reset() {
                this.gameDate = new Date(2025, 0, 1, 6, 0, 0).getTime();
                this.startDate = this.gameDate;
                this.startRealTime = performance.now();
                this.minutesPassed = 0;
                this.dayChanges = 0;
                this.frameCount = 0;
                this.deltaSum = 0;
                this.accumulator = 0;
                this.log('Test reiniciado', 'warning');
            }
        }

        // Inicializar
        const timeManager = new TestTimeManager();
        let lastTick = 0;

        // Controles
        document.getElementById('btn-pause').addEventListener('click', () => {
            const paused = timeManager.togglePause();
            document.getElementById('pause-status').textContent = paused ? 'PAUSADO' : 'CORRIENDO';
            document.getElementById('pause-status').style.color = paused ? '#ffa500' : '#00ff88';
        });

        document.querySelectorAll('[data-speed]').forEach(btn => {
            btn.addEventListener('click', () => {
                const speed = parseFloat(btn.dataset.speed);
                timeManager.setSpeed(speed);
                document.getElementById('speed-display').textContent = `${speed}x`;
                
                // Actualizar bot√≥n activo
                document.querySelectorAll('[data-speed]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            });
        });

        document.getElementById('btn-reset').addEventListener('click', () => {
            timeManager.reset();
            document.getElementById('event-log').innerHTML = '';
        });

        // Loop principal
        function gameLoop(timestamp) {
            if (lastTick === 0) lastTick = timestamp;
            const delta = timestamp - lastTick;
            
            timeManager.update(delta);
            updateUI();
            
            lastTick = timestamp;
            requestAnimationFrame(gameLoop);
        }

        function updateUI() {
            // Fecha y hora
            const dateObj = new Date(timeManager.gameDate);
            const day = dateObj.getDate();
            const month = dateObj.toLocaleDateString('es-ES', { month: 'short' }).toUpperCase();
            const year = dateObj.getFullYear();
            const hours = String(dateObj.getHours()).padStart(2, '0');
            const minutes = String(dateObj.getMinutes()).padStart(2, '0');
            const seconds = String(dateObj.getSeconds()).padStart(2, '0');
            
            document.getElementById('game-time').textContent = `${day} ${month} ${year} ${hours}:${minutes}:${seconds}`;

            // Tiempo real transcurrido
            const realElapsed = Math.floor((performance.now() - timeManager.startRealTime) / 1000);
            document.getElementById('real-time').textContent = `${realElapsed}s`;

            // Estad√≠sticas de juego
            document.getElementById('game-minutes').textContent = timeManager.minutesPassed;
            const hoursElapsed = Math.floor(timeManager.minutesPassed / 60);
            document.getElementById('game-hours').textContent = hoursElapsed;
            document.getElementById('game-days').textContent = timeManager.dayChanges;

            // FPS y Delta
            if (timeManager.frameCount > 0) {
                const fps = Math.round(timeManager.frameCount / (realElapsed || 1));
                document.getElementById('fps').textContent = fps;
                
                const avgDelta = Math.round(timeManager.deltaSum / timeManager.frameCount);
                document.getElementById('delta-avg').textContent = `${avgDelta}ms`;
            }

            // Progreso del d√≠a
            const minutesSinceMidnight = dateObj.getHours() * 60 + dateObj.getMinutes();
            const dayProgress = (minutesSinceMidnight / 1440) * 100;
            document.getElementById('day-progress').style.width = `${dayProgress}%`;
        }

        // Iniciar el loop
        timeManager.log('Sistema de tiempo iniciado', 'success');
        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
